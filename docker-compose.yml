
services:
  nethermind-arbitrum:
    image: ${NETHERMIND_IMAGE:-nethermind/nethermind-arbitrum:0.0.1-alpha}
    container_name: nethermind-arbitrum
    restart: 'no'
    ports:
      - 20545:20545
      - 20551:20551
      - 30303:30303/tcp
      - 30303:30303/udp
      - 8008:8008
    volumes:
      - ./nethermind-data:/app/nethermind_db
    command:
      - -c=${NETWORK:-arbitrum-mainnet}
      - --data-dir=/app/nethermind_db
      - --JsonRpc.Host=0.0.0.0
      - --JsonRpc.EngineHost=0.0.0.0
      - --JsonRpc.JwtSecretFile=/app/nethermind_db/jwt.hex
    networks:
      - nethermind-network
    healthcheck:
      test:
        - CMD-SHELL
        - timeout 5 bash -c '</dev/tcp/localhost/20551' || exit 1
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s

  nitro:
    image: ${NITRO_IMAGE:-offchainlabs/nitro-node:v3.10.0-rc.1-3a25bb0}
    container_name: nitro
    entrypoint: /usr/local/bin/nitro
    depends_on:
      nethermind-arbitrum:
        condition: service_healthy
    restart: 'no'
    ports: []
    volumes:
      - ./nitro-data:/tmp/nitro-data
      - ./nethermind-data:/nethermind-data:ro
    command:
      - --init.empty
      - --persistent.global-config=/tmp/nitro-data
      - --parent-chain.connection.url=${PARENT_CHAIN_RPC_URL}
      - --parent-chain.blob-client.beacon-url=${PARENT_CHAIN_BEACON_URL}
      - --chain.id=${CHAIN_ID:-42161}
      - --execution.forwarding-target=null
      - --log-level=${LOG_LEVEL:-INFO}
      - --node.execution-rpc-client.url=http://nethermind-arbitrum:20551
      - --node.execution-rpc-client.jwtsecret=/nethermind-data/jwt.hex
      - --node.sequencer=false
    networks:
      - nethermind-network

networks:
  nethermind-network:
    name: nethermind-network
