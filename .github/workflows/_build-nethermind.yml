name: Build Nethermind

on:
  workflow_call:
    inputs:
      project:
        description: 'Project to build (csproj path)'
        required: false
        default: 'src/Nethermind.Arbitrum/Nethermind.Arbitrum.csproj'
        type: string
      configuration:
        description: 'Build configuration (Debug/Release)'
        required: false
        default: 'Debug'
        type: string
      artifact_name:
        description: 'Name for the build artifact (empty = no upload)'
        required: false
        default: ''
        type: string

permissions:
  contents: read

jobs:
  build:
    name: Build Nethermind (${{ inputs.configuration }})
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true
          persist-credentials: false

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '10.0.x'

      - name: Cache NuGet packages
        uses: actions/cache@v4
        with:
          path: ~/.nuget/packages
          key: ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}
          restore-keys: |
            ${{ runner.os }}-nuget-

      - name: Build
        run: dotnet build ${{ inputs.project }} -c ${{ inputs.configuration }}

      - name: Upload build artifact
        if: inputs.artifact_name != ''
        uses: actions/upload-artifact@v4
        with:
          name: ${{ inputs.artifact_name }}
          path: src/Nethermind/src/Nethermind/artifacts/bin/Nethermind.Runner/${{ inputs.configuration == 'Debug' && 'debug' || 'release' }}/
          retention-days: 1
